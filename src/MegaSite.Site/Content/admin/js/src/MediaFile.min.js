var MediaFileManagerModule;(function(n){function i(n,t){return n.each(function(){var n=$(this);n.data("mediafilemanager")||n.data("mediafilemanager",new r(n,t))})}n.init=i,function(n){n._map=[],n._map[0]="Picker",n.Picker=0,n._map[1]="Album",n.Album=1}(n.MediaFileManagerType||(n.MediaFileManagerType={}));var t=n.MediaFileManagerType,r=function(){function n(n,i){var u=this,r;if(this._rootUrl=i.rootUrl?i.rootUrl:null,this._uploadUrl=i.uploadUrl?i.uploadUrl:null,this._listItemsUrl=i.listItemsUrl?i.listItemsUrl:null,this._thumbUrl=i.thumbUrl?i.thumbUrl:null,this._thumbSize=i.thumbSize?i.thumbSize:240,this._selectText=i.selectText?i.selectText:"Select media",this._changeText=i.changeText?i.changeText:"Change media",this._removeText=i.removeText?i.removeText:"Remove media",this._okText=i.okText?i.okText:"Ok",this._uploadText=i.uploadText?i.uploadText:"Upload",this._type=i.type,r=this,this._type==t.Picker){this._element=this.pickerHtml(),jQuery(document.body).append(this._element);this._element.on("dblclick",".item",function(){r.selectItem(jQuery(this))});this._element.on("click",".item",function(){r.checkItem($(this))});this._element.on("click",".btn-ok",function(){return u.onOkClick()});jQuery.getJSON(this._listItemsUrl,function(n){return u.fillGallery(n)}),this.registerField(n)}else if(this._type==t.Album){this._element=this.bodyHtml(),this._element.addClass("album"),this._element.data("field",n),this._currentControl=this._element,n.hide(),n.val()&&this.fillGallery(JSON.parse(n.val()));this._element.on("click",".btn-danger",function(){$(this).closest(".item").fadeOut(500,function(){$(this).remove(),r.fillCurrentControl(null)})});this._element.insertAfter(n)}this.setupUploader(this._element,this._uploadUrl)}return n.prototype.onOkClick=function(){this.selectItem(this._element.find(".selected"))},n.prototype.pickerHtml=function(){var n=$('<div class="modal hide fade media-picker-modal">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×<\/button>                        <h3>'+this._selectText+'<\/h3>                    <\/div>                    <div class="modal-body"><\/div>                    <div class="modal-footer">                        <button class="btn btn-primary btn-ok">'+this._okText+"<\/button >                    <\/div>                <\/div>");return n.find(".modal-body").append(this.bodyHtml()),n},n.prototype.bodyHtml=function(){var n=Math.floor(Math.random()*100);return $('<div class="row-fluid">                    <div class="span3">                        <div id="media-picker-uploader">                            <form>                                <input class="file-upload" name="file" type="file" multiple="true" />                                <div class="queue" id="queue'+n+'"><\/div>                            <\/form>                        <\/div>                    <\/div>                    <div class="span9 row-fluid media-picker-gallery" >                    <\/div>                <\/div>')},n.prototype.itemHtml=function(n){var i=$('<div class="span2 item">'+this.thumbHtml(n)+"<\/div>");return this._type==t.Album&&i.append('<button type="button" class="btn btn-danger">×<\/button>'),i.data("mediaFile",n),i},n.prototype.thumbHtml=function(n){var t,i;return n==null?"":(n.ThumbUrl!=null?t=n.ThumbUrl:(i=n.Url?base64.encode(n.Url):null,t=this._thumbUrl+"/"+n.FileName+"-"+this._thumbSize+"x"+this._thumbSize+"-crop.jpg",i!=null&&(t+="?url="+i)),'<img class="img-rounded" src="'+t+'" />')},n.prototype.galleryListHtml=function(n){for(var i=[],r,t=0;t<n.length;t++)r=n[t],i.push(this.itemHtml(r));return i},n.prototype.checkItem=function(n){this._element.find(".item").removeClass("selected"),n.addClass("selected")},n.prototype.selectItem=function(n){this.fillCurrentControl(n.data("mediaFile")),this._element.modal("hide")},n.prototype.fillGallery=function(n){jQuery(this._element.find(".media-picker-gallery").append(this.galleryListHtml(n)))},n.prototype.fillCurrentControl=function(n){if(this._type==t.Picker)n?(this._currentControl.data("field").val(JSON.stringify(n)),this._currentControl.html(""),this._currentControl.append(this.thumbHtml(n)),this._currentControl.append($('<div class="btn btn-change call-modal">'+this._changeText+"...<\/div>")),this._currentControl.append($('<div class="btn btn-remove btn-danger">'+this._removeText+"...<\/div>"))):this._currentControl.html('<a href="javascript:void(0)" class="btn-empty call-modal img-rounded"><i class="icon icon-picture" style="font-size: 90px;"><\/i><br />'+this._selectText+"...<\/div>");else{var i=[];this._element.find(".item").each(function(){i.push($(this).data("mediaFile"))}),this._currentControl.data("field").val(JSON.stringify(i))}},n.prototype.setupUploader=function(n,i){var r=this,u=n.find(".file-upload");u.uploadifive({auto:!0,removeCompleted:!0,fileType:"image",buttonClass:"btn",height:"20",width:"auto",buttonText:'<i class="icon-cloud-upload"><\/i> '+r._uploadText+"...",formData:{test:"something"},queueID:n.find(".queue").attr("id"),uploadScript:i,simUploadLimit:1,onUploadComplete:function(i,u){var e=jQuery.parseJSON(u),f;e.FileName!=null&&(f=$(r.itemHtml(e)),jQuery(n.find(".media-picker-gallery").prepend(f)),r._type==t.Picker?r.checkItem(f):r._type==t.Album&&r.fillCurrentControl(null))}})},n.prototype.registerField=function(n){var t=this,i,r,u;if(n.hide(),!n.data("mediapicker")){n.data("mediapicker",!0),i=$('<div class="media-file-picker-control"><\/div>'),i.data("field",n),r=n.val(),u=null,r&&(u=jQuery.parseJSON(r)),t._currentControl=i,t.fillCurrentControl(u);i.on("click",".call-modal",function(){t._currentControl=$(this).parent(),t._element.modal("show")}).on("click",".btn-remove",function(){$(this).parent().data("field").val(""),t._currentControl=i,t.fillCurrentControl(null)}).on("mouseover",function(){$(this).find(".btn").show()}).on("mouseout",function(){$(this).find(".btn").hide()});i.insertAfter(n)}},n}()})(MediaFileManagerModule||(MediaFileManagerModule={})),function(n){n.fn.mediaFileManager=function(t){for(var r=[],i=0;i<arguments.length-1;i++)r[i]=arguments[i+1];if(MediaFileManagerModule[t])return MediaFileManagerModule[t].apply(MediaFileManagerModule,[this].concat(r));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on jQuery.mediaFileManager");else return MediaFileManagerModule.init.call(MediaFileManagerModule,this,arguments[0])}}(jQuery)